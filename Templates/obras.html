{% extends '_Layout.html' %}


{% block content %}

<div class="content" style="height: 30%;">
    <div class="wrapper wrapper-content animated fadeInRight" >

        <div class="row">
            <div class="col-lg-12">
            <div class="ibox ">
                <div class="ibox-title">
                    <h5>Listado</h5>
                    <input type="hidden" id="vmsj" value="{{mensaje}}" />
                    <div class="ibox-tools">
                        <a class="collapse-link">
                            <i class="fa fa-chevron-up"></i>
                        </a>
                    </div>
                </div>
                <div class="ibox-content">

                    <div class="table-responsive">
                <div id="DataTables_Table_0_wrapper" class="dataTables_wrapper dt-bootstrap4">
                <div class="html5buttons">
                    <div class="dt-buttons btn-group flex-wrap">          

                   <!-- <a href="crear/" class="btn btn-sm btn-primary" ><span>Agregar</span> <i style="btn-primary" class="fa fa-plus"></i></a> -->
                    
                    </div>
                </div>


                <table class="table table-striped table-bordered table-hover dataTables-example dataTable" id="dtObras" aria-describedby="DataTables_Table_0_info" role="grid">
                <thead>
                <tr role="row">
                    <th class="sorting">Código</th>
                    <th class="sorting">Descripción</th>
                    <th class="sorting">Dirección</th>
                    <th class="sorting" style="text-align: center;">Acciones</th>
                </tr>
                </thead>
                <tbody>
                {% for obras in obrasU %}
                    <tr>
                        <td>{{obras.cod}}</td>
                        <td>{{obras.descripcion}}</td>
                        <td>{{obras.direccionCalle}} {{obras.direccionNumero}}</td>

                        <td style="text-align: center;width:10%"><a href="{% url 'obras_configuracion' obras.id %}"><i class="fa fa-gear" style="font-size: 1.3rem; color:#CE9446"></i></a></td>
                    </tr>
                {% endfor %}
                </tbody>

                </table>

                <div class="dataTables_paginate paging_simple_numbers" id="DataTables_Table_0_paginate">
                        <ul class="pagination">
                            <li class="paginate_button page-item prev" id="prev">
                                <a href="#" aria-controls="DataTables_Table_0" data-dt-idx="0" tabindex="0" class="page-link"><</a>
                            </li>
                                <li class="paginate_button page-item active">
                                    <span id="page-info"> Página {{ obrasU.number }} de {{ obrasU.paginator.num_pages }} </span>
                            </li>
                            
                        <li class="paginate_button page-item next" id="next"><a href="#" aria-controls="DataTables_Table_0" data-dt-idx="4" tabindex="0" class="page-link">></a></li></ul>
                </div>

                <div id="pagination">
                    
                    <input id="hCurrentPage" type="hidden" value="{{ obrasU.number }}" />
                    <input id="hTotalPage" type="hidden" value="{{ obrasU.paginator.num_pages }}" />

                </div>
                    </div>
                    </div>

                </div>
            </div>
        </div>
        </div>
    </div>
</div>
    <script>
        $(function(){
            let value= $("#vmsj").val();
            if(value=="OK")
            {
                $("#msjOk").html("Obra registrada correctamente");
                $("#modalOk").modal("show");
            }
            function loadPage(page) {
                $.ajax({
                    url: "{% url 'obras' %}",
                    data: {page: page},
                    success: function(data) {
                        $('#dtObras tbody').empty();
                        data.obras.forEach(function(obra) {
                            $('#dtObras tbody').append('<tr>'
                                    +'<td>' + obra.codigo + '</td>'
                                    +'<td>' + obra.descripcion + '</td>'
                                    +'<td>' + obra.direccionCalle +' '+ obra.direccionNumero +'</td>'
                                    +'<td style="text-align: center;width:10%"><a href="/Tratos/obras/' + obra.id + '/"><i class="fa fa-file-text" style="font-size: 1.3rem; color:#CE9446"></i></a></td></tr>');
                        });
                        
                        $("#hCurrentPage").val(data.current_page);
                        $("#hTotalPage").val(data.num_pages);

                        $('#prev').prop('disabled', !data.has_previous);
                        $('#next').prop('disabled', !data.has_next);

                        $('#page-info').text('Página ' + data.current_page + ' de ' + data.num_pages);
                    }
                });
            }
            $('#prev').click(function(){
                currentPage = $("#hCurrentPage").val();
                if (currentPage > 1) {
                    loadPage(currentPage - 1);
                }
            });

            $('#next').click(function(){
                currentPage = parseInt($("#hCurrentPage").val());
                totalPages = parseInt($("#hTotalPage").val());
                if (currentPage < totalPages) {
                    loadPage(currentPage + 1);
                }
            });
        });


        
    </script>
{% endblock %}
